<!DOCTYPE html>
<html lang="en">
<head>
    <title>Checkout</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="styles.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <section class="header-2">
        <nav>
            <a href="index.html"><img src="images/logo1.svg" alt="Logo"></a>
            <div class="nav-link" id="navLink">
                <i class="fa fa-window-close" onclick="hideMenu()"></i>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="product.html">Shop</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <i class="fa fa-bars" onclick="showMenu()"></i>
        </nav>
    </section>

    <div class="small-container">
        <h2>Checkout</h2>
        <form id="checkout-form" class="checkout-form">
            <div class="form-group">
                <label for="name">Full Name</label><br>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label><br>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="address">Shipping Address</label><br>
                <input type="text" id="address" name="address" required>
            </div>
            <div class="form-group">
                <label for="payment">Payment Method</label><br>
                <select id="payment" name="payment" required>
                    <option value="">Select</option>
                    <option value="credit">Credit Card</option>
                    <option value="paypal">PayPal</option>
                    <option value="crypto">Cryptocurrency</option>
                </select>
            </div>
            <div class="form-group" id="card-details" style="display:none;">
                <label for="card-number">Card Number</label><br>
                <input type="text" id="card-number" name="card-number" maxlength="19" placeholder="1234 5678 9012 3456">
            </div>
            <div class="form-group">
                <label for="coupon">Coupon Code</label><br>
                <input type="text" id="coupon" name="coupon" placeholder="Enter coupon code (optional)">
                <button type="button" id="apply-coupon" class="button" style="margin-top:8px;width:auto;padding:6px 16px;font-size:0.95em;">Apply Coupon</button>
                <span id="coupon-msg" style="margin-left:12px;color:#1a7f37;font-weight:bold;"></span>
            </div>
            <button type="submit" class="button">Place Order</button>
        </form>
        <div class="order-sort" style="margin-top:12px;">
            <label for="order-sort" style="margin-right:6px;">Sort by:</label>
            <select id="order-sort">
                <option value="price-asc">Price: Low to High</option>
                <option value="price-desc">Price: High to Low</option>
            </select>
        </div>
        <div id="order-summary" class="order-summary"></div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col-1">
                  <img src="images/logo1.svg" alt="Logo">
                  <p>Lorem ipsum dolor sit amet consectetur adipisicing <br>
                     nobis dolorem et temporibus, ipsam dolor.</p>
                </div>

                <div class="footer-col-2">
                    <h3>Usefull Links</h3>
                    <ul>
                        <li>Coupons</li>
                        <li>Blog Posts</li>
                        <li>Return Policy</li>
                        <li>Join Affiliate</li>
                    </ul>
                </div>
                
                <div class="footer-col-3">
                    <h3>Follow Us on </h3>
                    <ul>
                        <li><a href="https://www.instagram.com/an1magnet?utm_source=qr&igsh=YWFrYTh4bDlmb2Mz">instagram</a></li>
                        <li>X-twitter</li>
                        <li>Facebook</li>
                        <li>Whatsapp</li>
                    </ul>
                </div>

                <div class="footer-col-4">
                    <h3>Payment Mode</h3>
                    <ul>
                        <li>Credit Cards</li>
                        <li>Digital wallet</li>
                        <li>Cryptocurrency</li>
                        <li>Paypal</li>
                    </ul>
                </div>
            </div>

            <hr>
            <p class="copyright">copyright2025 - Animagnetweb test</p>
        </div>
    </div>

    <script src="products.js"></script>
    <script>
// Simple toast notifications
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.textContent = message;
    toast.style.position = 'fixed';
    toast.style.bottom = '32px';
    toast.style.right = '32px';
    toast.style.background = type === 'error' ? '#ffdddd' : (type === 'success' ? '#d4edda' : '#e0e0e0');
    toast.style.color = type === 'error' ? '#a94442' : (type === 'success' ? '#155724' : '#333');
    toast.style.padding = '12px 24px';
    toast.style.borderRadius = '6px';
    toast.style.zIndex = '9999';
    toast.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
    toast.style.fontWeight = 'bold';
    document.body.appendChild(toast);
    setTimeout(() => { if (toast) toast.remove(); }, 3000);
}

// Checkout page logic
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('checkout-form');
    const summary = document.getElementById('order-summary');
    const couponBtn = document.getElementById('apply-coupon');
    const couponInput = document.getElementById('coupon');
    const couponMsg = document.getElementById('coupon-msg');

    const paymentSelect = document.getElementById('payment');
    const cardDetails = document.getElementById('card-details');
    const cardNumberInput = document.getElementById('card-number');

    let discountType = null; // 'SAVE10' or 'FREESHIP' or null
    let orderSortMode = 'price-asc';

    // Helpers
    function luhnCheck(num) {
        const arr = String(num).split('').reverse().map(x => parseInt(x, 10));
        let sum = 0;
        for (let i = 0; i < arr.length; i++) {
            let val = arr[i];
            if (i % 2 === 1) {
                val *= 2;
                if (val > 9) val -= 9;
            }
            sum += val;
        }
        return sum % 10 === 0;
    }

    function toggleCardDetails() {
        if (paymentSelect.value === 'credit') {
            cardDetails.style.display = 'block';
            cardNumberInput.required = true;
        } else {
            cardDetails.style.display = 'none';
            cardNumberInput.required = false;
            cardNumberInput.value = '';
        }
    }

    if (paymentSelect) {
        paymentSelect.addEventListener('change', toggleCardDetails);
        toggleCardDetails();
    }
    if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim();
        });
    }

    function getProductsMap() {
        const map = new Map();
        try {
            if (typeof products !== 'undefined' && Array.isArray(products)) {
                products.forEach(p => map.set(p.name, p));
            } else {
                const stored = JSON.parse(sessionStorage.getItem('allProducts') || '[]');
                if (Array.isArray(stored)) {
                    stored.forEach(p => map.set(p.name, p));
                }
            }
        } catch (e) {
            // ignore and return whatever we have
        }
        return map;
    }

    function getCart() {
        try {
            return JSON.parse(sessionStorage.getItem('cart')) || [];
        } catch (e) {
            return [];
        }
    }

    function formatCurrency(n) { return '$' + (Number(n) || 0).toFixed(2); }

    function calcTotals() {
        const cart = getCart();
        const productMap = getProductsMap();
        let subtotal = 0;
        cart.forEach(item => {
            const prod = productMap.get(item.name);
            const price = prod && prod.price ? Number(prod.price) : 0;
            const qty = Number(item.quantity) || 0;
            subtotal += price * qty;
        });
        const shipping = subtotal > 0 ? 5 : 0;
        let discountSubtotal = 0;
        let discountShipping = 0;
        if (discountType === 'SAVE10') discountSubtotal = Math.min(10, subtotal);
        if (discountType === 'FREESHIP') discountShipping = Math.min(5, shipping);
        const total = Math.max(0, subtotal - discountSubtotal + (shipping - discountShipping));
        return { cart, subtotal, shipping, discountSubtotal, discountShipping, total, productMap };
    }

    function renderSummary() {
        const s = calcTotals();
        if (!summary) return;
        if (s.cart.length === 0) {
            summary.innerHTML = '<p>Your cart is empty.</p>';
            return;
        }
        const shipAddress = (form && form.elements['address']) ? form.elements['address'].value.trim() : '';
        const shipAddressHtml = shipAddress.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        const itemsSorted = s.cart.slice().sort(function(a, b){
            const pa = Number((s.productMap.get(a.name)||{}).price) || 0;
            const pb = Number((s.productMap.get(b.name)||{}).price) || 0;
            return orderSortMode === 'price-desc' ? (pb - pa) : (pa - pb);
        });
        const itemsHtml = itemsSorted.map(i => {
            const prod = s.productMap.get(i.name) || {};
            const price = Number(prod.price) || 0;
            const img = Array.isArray(prod.images) && prod.images.length ? prod.images[0] : '';
            const sizeStr = i.size ? ' (' + i.size + ')' : '';
            const nameHtml = '<span class="item-name">' + i.name + (sizeStr ? '<span class="item-meta">' + sizeStr + '</span>' : '') + ' x ' + i.quantity + '</span>';
            const priceHtml = '<span class="item-price">' + formatCurrency(price * i.quantity) + '</span>';
            const imgHtml = img ? '<img class="item-thumb" src="' + img + '" alt="">' : '<div class="item-thumb placeholder"></div>';
            return '<li class="order-item"><div class="item-left">' + imgHtml + nameHtml + '</div>' + priceHtml + '</li>';
        }).join('');
        summary.innerHTML = '<div class="checkout-summary-card">'
            + '<h3>Order Summary</h3>'
            + '<ul class="order-items">' + itemsHtml + '</ul>'
            + '<div class="order-totals">'
            +   '<div class="order-row subtotal"><span>Subtotal</span><span>' + formatCurrency(s.subtotal) + '</span></div>'
            +   '<div class="order-row shipping"><span>Shipping</span><span>' + formatCurrency(s.shipping) + (s.discountShipping ? '<span class="note"> (coupon -' + formatCurrency(s.discountShipping) + ')</span>' : '') + '</span></div>'
            +   (s.discountSubtotal ? '<div class="order-row discount"><span>Discount</span><span>- ' + formatCurrency(s.discountSubtotal) + '</span></div>' : '')
            +   '<div class="order-row total"><span>Total</span><span>' + formatCurrency(s.total) + '</span></div>'
            + '</div>'
            + (shipAddress ? '<div class="order-shipto">Ship to: <strong>' + shipAddressHtml + '</strong></div>' : '')
            + '</div>';
    }

    renderSummary();

    const addressInput = document.getElementById('address');
    if (addressInput) { addressInput.addEventListener('input', renderSummary); }
    const orderSortSelect = document.getElementById('order-sort');
    if (orderSortSelect) {
        orderSortSelect.addEventListener('change', function(){
            orderSortMode = this.value;
            renderSummary();
        });
    }

    // Coupon handling
    couponBtn.addEventListener('click', function() {
        const code = couponInput.value.trim().toUpperCase();
        if (code === 'SAVE10') {
            discountType = 'SAVE10';
            couponMsg.textContent = 'Coupon applied: $10 off!';
            showToast('Coupon applied: $10 off!', 'success');
        } else if (code === 'FREESHIP') {
            discountType = 'FREESHIP';
            couponMsg.textContent = 'Coupon applied: $5 off shipping!';
            showToast('Coupon applied: $5 off shipping!', 'success');
        } else if (code) {
            discountType = null;
            couponMsg.textContent = 'Invalid coupon code.';
            showToast('Invalid coupon code.', 'error');
        } else {
            discountType = null;
            couponMsg.textContent = '';
        }
        renderSummary();
    });

    // Form submission
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = form.elements['name'].value.trim();
        const email = form.elements['email'].value.trim();
        const address = form.elements['address'].value.trim();
        const payment = form.elements['payment'].value;

        if (!name || !email || !address || !payment) {
            showToast('Please fill in all fields.', 'error');
            return;
        }
        if (!email.match(/^[^@\s]+@[^@\s]+\.[^@\s]+$/)) {
            showToast('Please enter a valid email address.', 'error');
            return;
        }
        if (payment === 'credit') {
            const rawCard = (cardNumberInput.value || '').replace(/\s+/g, '');
            if (!/^\d{13,19}$/.test(rawCard) || !luhnCheck(rawCard)) {
                showToast('Please enter a valid card number.', 'error');
                return;
            }
        }

        // Generate order
        const orderId = 'ORD-' + Math.floor(Math.random() * 1000000);
        const deliveryDate = new Date();
        deliveryDate.setDate(deliveryDate.getDate() + 5);
        const deliveryStr = deliveryDate.toLocaleDateString();
        const totals = calcTotals();

        summary.innerHTML = `<h3>Order Placed!</h3><p>Order ID: <strong>${orderId}</strong><br>Thank you, ${name}.<br>Your order will be shipped to:<br><strong>${address}</strong><br>Estimated delivery: <strong>${deliveryStr}</strong><br>Confirmation sent to: <strong>${email}</strong><br>Total charged: <strong>${formatCurrency(totals.total)}</strong></p>`;
        showToast('Order placed successfully!', 'success');

        // Reset state
        form.reset();
        sessionStorage.setItem('cart', JSON.stringify([]));
        discountType = null;
        couponMsg.textContent = '';
        toggleCardDetails();
        renderSummary();
    });
});
    </script>

    <script>
        var navLink = document.getElementById("navLink");
        function showMenu(){
            navLink.style.right ="0";
        }
        function hideMenu(){
            navLink.style.right ="-200px";
        }
    </script>
</body>
</html>
